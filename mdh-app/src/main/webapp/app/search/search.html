<h1>Data Lake Search Application</h1>
<div class="row" ng-if="!ctrl.currentUser">Please log in to see content</div>

<div class="row" ng-if="ctrl.currentUser">
  <div class="col-md-12">
    <tabset>
      <tab heading="Basic Search" select="ctrl.setMode('basic')">
        <ml-input qtext="ctrl.qtext" search="ctrl.search(qtext)" template="fa" 
          class="search"></ml-input>
      </tab>
      <tab heading="Person Search" select="ctrl.setMode('person')">
        <form ng-submit="ctrl.doSearch(ctrl.person)" class="`ml-input ml-search form-inline" 
          role="search">
          <accordion close-others="false">
            <accordion-group heading="Name" is-open="status.isNameOpen">
              <div class="row">
                <div class="col-sm-4">
                  <label>First:</label>
                  <input ng-model="ctrl.person.firstName" type="text" class="form-control"
                    placeholder="First Name..." autocomplete="off"
                    typeahead="suggestion for suggestion in ctrl.suggest($viewValue, 'suggest-firstname')" 
                    typeahead-suggest-on-select="true" 
                    typeahead-loading="loadingSuggestions.firstname"></input>
                </div>
                <div class="col-sm-4">
                  <label>Middle:</label>
                  <input ng-model="ctrl.person.middleName" type="text" class="form-control" 
                    placeholder="Middle Name..." autocomplete="off"></input>
                </div>
                <div class="col-sm-4">
                  <label>Last:</label>
                  <input ng-model="ctrl.person.lastName" type="text" class="form-control" 
                    placeholder="Last Name..." autocomplete="off"
                    typeahead="suggestion for suggestion in ctrl.suggest($viewValue, 'suggest-lastname')" 
                    typeahead-suggest-on-select="true" 
                    typeahead-loading="loadingSuggestions"></input>
                </div>
              </div>
            </accordion-group>
            <accordion-group heading="Address" is-open="status.isAddressOpen">
              <div class="row">
                <div class="col-sm-12">
                  <label>Street:</label>
                  <input ng-model="ctrl.person.address.street" type="text" class="form-control" 
                    placeholder="Street..." autocomplete="off"></input>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-5">
                  <label>City:</label>
                  <input ng-model="ctrl.person.address.city" type="text" class="form-control" 
                    placeholder="City..." autocomplete="off"
                    typeahead="suggestion for suggestion in ctrl.suggest($viewValue, 'suggest-city')" 
                    typeahead-suggest-on-select="true" 
                    typeahead-loading="loadingSuggestions"></input>
                </div>
                <div class="col-sm-3">
                  <label>State:</label>
                  <input ng-model="ctrl.person.address.state" type="text" class="form-control" 
                    placeholder="State..." autocomplete="off"></input>
                </div>
                <div class="col-sm-4">
                  <label>Zip:</label>
                  <input ng-model="ctrl.person.address.zip" type="text" class="form-control" 
                    placeholder="Zip Code..." autocomplete="off"></input>
                </div>
              </div>
            </accordion-group>
            <accordion-group heading="Detail" is-open="status.isDetailOpen">
              <div class="row">
                <div class="col-sm-2">
                  <label>Date of Birth:</label>
                </div>
                <div class="col-sm-3">
                  <div class="input-group">
                    <input type="text" class="form-control" datepicker-popup ng-model="ctrl.person.dob" 
                      is-open="status.opened" min-date="minDate" max-date="'2020-06-22'" 
                      datepicker-options="dateOptions" date-disabled="disabled(date, mode)" 
                      ng-required="true" close-text="Close" />
                    <span class="input-group-btn">
                      <button type="button" class="btn btn-default" ng-click="open($event)">
                        <i class="glyphicon glyphicon-calendar"></i>
                      </button>
                    </span>
                  </div>                
                </div>
              </div>
            </accordion-group>
          </accordion>
        </form>
        <pre ng-if="ctrl.debug">person = {{ctrl.person | json}}</pre>
        <div class="row">
          <div class="col-sm-offset-2 col-sm-3">
            <button id="single-button" type="button" class="btn btn-primary" 
              dropdown-toggle ng-disabled="disabled" ng-click="ctrl.doSearch(ctrl.person)">
              <i class="fa fa-search"></i> Search
            </button>
          </div>
          <div class="col-sm-offset-2 col-sm-3">
            <button id="single-button" type="button" class="btn btn-primary" 
              dropdown-toggle ng-disabled="disabled" ng-click="ctrl.clearText()">
              <i class="fa fa-times-circle"></i> Clear
            </button>
          </div>
        </div>
      </tab>
    </tabset>
  </div>
</div>

<div class="search row" ng-if="ctrl.currentUser">
  <div class="col-md-3 right-col">
    <!--
    <div class="checkbox">
      <label>
        <input type="checkbox" ng-model="ctrl.runMapSearch" ng-change="ctrl.toggleMapSearch()">
        Limit results to the visible map
      </label>
    </div>
    -->
    <ml-facets facets="ctrl.response.facets" toggle="ctrl.toggleFacet(facet, value)" 
      active-facets="ctrl.mlSearch.activeFacets" show-more="ctrl.mlSearch.showMoreFacets(facet, facetName)"
      negate="ctrl.toggleNegatedFacet(facet,value)"></ml-facets>
  </div>
  <div class="col-md-9">
    <h4 ng-if="ctrl.response.total === 0">No results to show</h4>
  <!--
    <ml-esri-search-map options="ctrl.mapOptions" features-list="ctrl.response.results" 
      facets="ctrl.myFacets.facets" 
      bounds-changed="ctrl.mapBoundsChanged(bounds)"></ml-esri-search-map>
  -->
    <br/>
    <div ng-if="ctrl.response.total > 0" class="results">
      <div class="pagination-ctrls">
        <pagination class="pagination pagination-sm" ng-model="ctrl.page" 
          ng-change="ctrl.selectPage()" max-size="10" boundary-links="true" 
          total-items="ctrl.response.total" items-per-page="ctrl.response['page-length']">
        </pagination>
        <!-- <ml-snippet set-snippet="ctrl.setSnippet(type)"></ml-snippet> -->
      </div>
      <ml-metrics search="ctrl.response" ></ml-metrics>
      <ml-results template="app/search/search-results-table.html" results="ctrl.response.results"></ml-results>
    </div>
  </div>
</div>